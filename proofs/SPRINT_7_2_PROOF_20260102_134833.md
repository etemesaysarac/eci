# Sprint 7.2 Proof Pack

- GeneratedAt: 2026-01-02T13:48:33
- BaseUrl: http://127.0.0.1:3001
- ConnectionId: cmjvat2w40000e6j473j38tno
- PackageId: 3504063748
- LineId: 5019899160

## Transcript tail

~~~text
>>   try {
>>     $r = Invoke-RestMethod -Method Post -Uri $Url -ContentType "application/json" -Body $body
>>     return @{ ok=$true; status=200; body=$r; raw=$null }
>>   } catch {
>>     $status = 0
>>     try { $status = [int]$_.Exception.Response.StatusCode.value__ } catch {}
>>     $bj = Try-ReadJsonFromError $_
>>     return @{ ok=$false; status=$status; body=$bj; raw=$_.Exception.Message }
>>   }
>> }
>>
>> $sum = New-Object System.Collections.Generic.List[object]
>>
>> Write-Host "Actions test (7.2)..." -ForegroundColor Cyan
>>
>> # 1) updateTrackingNumber (expected 400 olabilir)
>> $u1 = "{0}/v1/connections/{1}/shipment-packages/{2}/actions/update-tracking-number" -f $BaseUrl,$ConnectionId,$PackageId
>> $r1 = Invoke-PostJson $u1 @{ trackingNumber="TEST123"; cargoProvider="DHL" }
>> $k1 = Resolve-ExpectedError -Status $r1.status -BodyJson $r1.body
>> $sum.Add([pscustomobject]@{ action="updateTrackingNumber"; http=$r1.status; result=($r1.ok?"OK":$k1.classification); label=($r1.ok?"OK":$k1.label) })
>>
>> # 2) updatePackage Picking
>> $u2 = "{0}/v1/connections/{1}/shipment-packages/{2}/actions/update-package?refetch=1" -f $BaseUrl,$ConnectionId,$PackageId
>> $r2 = Invoke-PostJson $u2 @{ status="Picking"; lines=@(@{lineId=$LineId;quantity=1}); params=@{} }
>> $k2 = Resolve-ExpectedError -Status $r2.status -BodyJson $r2.body
>> $sum.Add([pscustomobject]@{ action="updatePackage(Picking)"; http=$r2.status; result=($r2.ok?"OK":$k2.classification); label=($r2.ok?"OK":$k2.label) })
>>
>> # 3) updatePackage Invoiced
>> $r3 = Invoke-PostJson $u2 @{ status="Invoiced"; lines=@(@{lineId=$LineId;quantity=1}); params=@{} }
>> $k3 = Resolve-ExpectedError -Status $r3.status -BodyJson $r3.body
>> $sum.Add([pscustomobject]@{ action="updatePackage(Invoiced)"; http=$r3.status; result=($r3.ok?"OK":$k3.classification); label=($r3.ok?"OK":$k3.label) })
>>
>> # 4) unsupplied (opsiyonel)
>> if (-not $SkipUnsupplied) {
>>   $u4 = "{0}/v1/connections/{1}/shipment-packages/{2}/actions/unsupplied" -f $BaseUrl,$ConnectionId,$PackageId
>>   $r4 = Invoke-PostJson $u4 @{ lines=@(@{lineId=$LineId;quantity=1}); reasonId=500 }
>>   $k4 = Resolve-ExpectedError -Status $r4.status -BodyJson $r4.body
>>   $sum.Add([pscustomobject]@{ action="unsupplied"; http=$r4.status; result=($r4.ok?"OK":$k4.classification); label=($r4.ok?"OK":$k4.label) })
>> }
>>
>> Write-Host "`nSUMMARY" -ForegroundColor Green
>> $sum | Format-Table -AutoSize
>> '@ | Set-Content -Encoding UTF8 -Path .\scripts\ps1\test_sprint7_2_actions.ps1
PS C:\dev\eci>
PS C:\dev\eci> # --- generate_sprint7_2_proof.ps1 (sağlam, ~~~ fence) ---
PS C:\dev\eci> @'
>> param(
>>   [string]$BaseUrl = "http://127.0.0.1:3001",
>>   [Parameter(Mandatory=$true)][string]$ConnectionId,
>>   [Parameter(Mandatory=$true)][string]$PackageId,
>>   [Parameter(Mandatory=$true)][long]$LineId,
>>   [string]$WorkerLogPath = "C:\dev\eci\worker.log",
>>   [string]$ActionsTranscriptPath = "C:\dev\eci\Çıktılar.txt"
>> )
>>
>> $ErrorActionPreference = "Stop"
>>
>> $ts = Get-Date -Format "yyyyMMdd_HHmmss"
>> $out = "C:\dev\eci\proofs\SPRINT_7_2_PROOF_{0}.md" -f $ts
>>
>> function Read-LastLines([string]$Path, [int]$N = 500) {
>>   if (-not (Test-Path $Path)) { return @() }
>>   $lines = Get-Content -LiteralPath $Path -ErrorAction SilentlyContinue
>>   if (-not $lines) { return @() }
>>   if ($lines.Count -le $N) { return $lines }
>>   return $lines | Select-Object -Last $N
>> }
>>
>> $trans = Read-LastLines $ActionsTranscriptPath 120
>> $worker = Read-LastLines $WorkerLogPath 600
>>
>> $md = New-Object System.Collections.Generic.List[string]
>> $md.Add("# Sprint 7.2 Proof Pack")
>> $md.Add("")
>> $md.Add(("- GeneratedAt: {0}" -f (Get-Date).ToString("s")))
>> $md.Add(("- BaseUrl: {0}" -f $BaseUrl))
>> $md.Add(("- ConnectionId: {0}" -f $ConnectionId))
>> $md.Add(("- PackageId: {0}" -f $PackageId))
>> $md.Add(("- LineId: {0}" -f $LineId))
>> $md.Add("")
>> $md.Add("## Transcript tail")
>> $md.Add("")
>> $md.Add("~~~text")
>> $trans | ForEach-Object { $md.Add($_) }
>> $md.Add("~~~")
>> $md.Add("")
>> $md.Add("## Worker log tail")
>> $md.Add("")
>> $md.Add("~~~text")
>> $worker | ForEach-Object { $md.Add($_) }
>> $md.Add("~~~")
>> $md.Add("")
>>
>> Set-Content -LiteralPath $out -Value ($md -join "`n") -Encoding UTF8
>> Write-Host ("OK: proof generated -> {0}" -f $out) -ForegroundColor Green
>> '@ | Set-Content -Encoding UTF8 -Path .\scripts\ps1\generate_sprint7_2_proof.ps1
PS C:\dev\eci>
PS C:\dev\eci> Write-Host "OK: scripts restored (test + proof) and expected_errors centralized." -ForegroundColor Green
OK: scripts restored (test + proof) and expected_errors centralized.
PS C:\dev\eci> cd C:\dev\eci
PS C:\dev\eci> $one = Get-Content .\scripts\ps1\eci_oneclick_proof.ps1 -Raw
PS C:\dev\eci> if ($one -notmatch "set-strictmode") {
>>   $one = "Set-StrictMode -Version Latest`n`$ErrorActionPreference = `"Stop`"`n`n" + $one
>>   Set-Content .\scripts\ps1\eci_oneclick_proof.ps1 -Value $one -Encoding UTF8
>> }
PS C:\dev\eci> Write-Host "OK: oneclick now fail-fast." -ForegroundColor Green
OK: oneclick now fail-fast.
PS C:\dev\eci> cd C:\dev\eci
PS C:\dev\eci> pwsh -ExecutionPolicy Bypass -File .\scripts\ps1\eci_oneclick_proof.ps1 `
>>   -ConnectionId "cmjvat2w40000e6j473j38tno" `
>>   -PackageId "3504063748" `
>>   -LineId 5019899160 `
>>   -SkipUnsupplied
ParserError: C:\dev\eci\scripts\ps1\eci_oneclick_proof.ps1:5
Line |
   5 |    [string]$BaseUrl = "http://127.0.0.1:3001",
     |                       ~~~~~~~~~~~~~~~~~~~~~~~
     | The assignment expression is not valid. The input to an assignment operator must be an
     | object that is able to accept assignments, such as a variable or a property.
PS C:\dev\eci>
~~~

## Worker log tail

~~~text

> @eci/core@0.0.1 eci:worker
> tsx src/eci/worker.ts

[dotenv@17.2.3] injecting env (18) from .env -- tip: ­şøá´©Å  run anywhere with `dotenvx run -- yourcommand`
[eci-worker] loaded .env from C:\dev\eci\services\core\.env (keys=18, override=true)
[eci-worker] 2026-01-02T10:35:57.358Z scheduler enabled {"everyMs":60000,"minIntervalMs":300000}
[eci-worker] 2026-01-02T10:35:57.360Z pid=23416 listening for jobs on queue: eci-jobs (redis://127.0.0.1:6379)
[eci-worker] 2026-01-02T10:35:57.390Z scheduler tick {"connections":1,"everyMs":60000,"minIntervalMs":300000}
[eci-worker] 2026-01-02T10:35:57.394Z scheduler skipped (only_due) {"connectionId":"cmjvat2w40000e6j473j38tno","lastAttemptAgoMs":32001}
[eci-worker] 2026-01-02T10:35:57.394Z scheduler tick done {"durationMs":35}
[eci-worker] 2026-01-02T10:36:57.373Z scheduler tick {"connections":1,"everyMs":60000,"minIntervalMs":300000}
[eci-worker] 2026-01-02T10:36:57.375Z scheduler skipped (only_due) {"connectionId":"cmjvat2w40000e6j473j38tno","lastAttemptAgoMs":91982}
[eci-worker] 2026-01-02T10:36:57.375Z scheduler tick done {"durationMs":6}
[eci-worker] 2026-01-02T10:37:57.381Z scheduler tick {"connections":1,"everyMs":60000,"minIntervalMs":300000}
[eci-worker] 2026-01-02T10:37:57.383Z scheduler skipped (only_due) {"connectionId":"cmjvat2w40000e6j473j38tno","lastAttemptAgoMs":151990}
[eci-worker] 2026-01-02T10:37:57.383Z scheduler tick done {"durationMs":6}
[eci-worker] 2026-01-02T10:38:57.395Z scheduler tick {"connections":1,"everyMs":60000,"minIntervalMs":300000}
[eci-worker] 2026-01-02T10:38:57.396Z scheduler skipped (only_due) {"connectionId":"cmjvat2w40000e6j473j38tno","lastAttemptAgoMs":212003}
[eci-worker] 2026-01-02T10:38:57.397Z scheduler tick done {"durationMs":5}
[eci-worker] 2026-01-02T10:39:57.404Z scheduler tick {"connections":1,"everyMs":60000,"minIntervalMs":300000}
[eci-worker] 2026-01-02T10:39:57.406Z scheduler skipped (only_due) {"connectionId":"cmjvat2w40000e6j473j38tno","lastAttemptAgoMs":272013}
[eci-worker] 2026-01-02T10:39:57.406Z scheduler tick done {"durationMs":6}
[eci-worker] 2026-01-02T10:40:57.426Z scheduler tick {"connections":1,"everyMs":60000,"minIntervalMs":300000}
[eci-worker] 2026-01-02T10:40:57.442Z scheduler enqueued TRENDYOL_SYNC_ORDERS {"connectionId":"cmjvat2w40000e6j473j38tno","jobId":"cmjwqtwm00001e62gj8q9elol"}
[eci-worker] 2026-01-02T10:40:57.443Z scheduler tick done {"durationMs":35}
[eci-worker] 2026-01-02T10:40:57.446Z job received {"name":"TRENDYOL_SYNC_ORDERS","jobId":"cmjwqtwm00001e62gj8q9elol","connectionId":"cmjvat2w40000e6j473j38tno","attempt":1,"maxAttempts":5}
[eci-worker] 2026-01-02T10:40:57.470Z syncOrders started {"connectionId":"cmjvat2w40000e6j473j38tno","status":"Created","startDate":1767349225562,"endDate":1767350337464,"pageSize":50,"windows":1}
[eci-worker] 2026-01-02T10:40:57.470Z syncOrders window started {"connectionId":"cmjvat2w40000e6j473j38tno","window":1,"windows":1,"startDate":1767349225562,"endDate":1767350337464,"status":"Created","pageSize":50}
[eci-worker] 2026-01-02T10:40:57.687Z page processed {"connectionId":"cmjvat2w40000e6j473j38tno","window":1,"windows":1,"page":0,"items":0,"fetched":0,"upserted":0,"totalPages":0,"shipUpserted":0}
[eci-worker] 2026-01-02T10:40:57.687Z syncOrders window finished {"connectionId":"cmjvat2w40000e6j473j38tno","window":1,"windows":1,"startDate":1767349225562,"endDate":1767350337464}
[eci-worker] 2026-01-02T10:40:57.687Z syncOrders finished {"connectionId":"cmjvat2w40000e6j473j38tno","fetched":0,"upserted":0,"shipUpserted":0,"requestedPages":1,"windows":1}
[eci-worker] 2026-01-02T10:40:57.696Z SYNC_SUMMARY {"connectionId":"cmjvat2w40000e6j473j38tno","jobId":"cmjwqtwm00001e62gj8q9elol","windowStart":"2026-01-02T10:20:25.562Z","windowEnd":"2026-01-02T10:38:57.464Z","fetched":0,"upserted":0,"inserted":0,"durationMs":226,"usedAutoWindow":true}
[eci-worker] 2026-01-02T10:40:57.703Z job success {"name":"TRENDYOL_SYNC_ORDERS","jobId":"cmjwqtwm00001e62gj8q9elol","connectionId":"cmjvat2w40000e6j473j38tno","summary":{"upserted":0,"fetched":0,"inserted":0,"updatedOrExisting":0,"countBefore":2,"countAfter":2,"status":"Created","startDate":1767349225562,"endDate":1767350337464,"pageSize":50,"windows":1,"requestedPages":1,"windowStart":"2026-01-02T10:20:25.562Z","windowEnd":"2026-01-02T10:38:57.464Z","durationMs":226,"usedAutoWindow":true,"overlapMinutes":15,"safetyDelayMinutes":2}}
[eci-worker] 2026-01-02T10:40:57.706Z completed event {"name":"TRENDYOL_SYNC_ORDERS","jobId":"cmjwqtwm00001e62gj8q9elol","connectionId":"cmjvat2w40000e6j473j38tno"}
[eci-worker] 2026-01-02T10:41:57.420Z scheduler tick {"connections":1,"everyMs":60000,"minIntervalMs":300000}
[eci-worker] 2026-01-02T10:41:57.422Z scheduler skipped (only_due) {"connectionId":"cmjvat2w40000e6j473j38tno","lastAttemptAgoMs":59967}
[eci-worker] 2026-01-02T10:41:57.422Z scheduler tick done {"durationMs":5}
[eci-worker] 2026-01-02T10:42:57.432Z scheduler tick {"connections":1,"everyMs":60000,"minIntervalMs":300000}
[eci-worker] 2026-01-02T10:42:57.434Z scheduler skipped (only_due) {"connectionId":"cmjvat2w40000e6j473j38tno","lastAttemptAgoMs":119979}
[eci-worker] 2026-01-02T10:42:57.434Z scheduler tick done {"durationMs":6}
[eci-worker] 2026-01-02T10:43:57.433Z scheduler tick {"connections":1,"everyMs":60000,"minIntervalMs":300000}
[eci-worker] 2026-01-02T10:43:57.435Z scheduler skipped (only_due) {"connectionId":"cmjvat2w40000e6j473j38tno","lastAttemptAgoMs":179980}
[eci-worker] 2026-01-02T10:43:57.435Z scheduler tick done {"durationMs":5}
[eci-worker] 2026-01-02T10:44:57.440Z scheduler tick {"connections":1,"everyMs":60000,"minIntervalMs":300000}
[eci-worker] 2026-01-02T10:44:57.442Z scheduler skipped (only_due) {"connectionId":"cmjvat2w40000e6j473j38tno","lastAttemptAgoMs":239987}
[eci-worker] 2026-01-02T10:44:57.442Z scheduler tick done {"durationMs":5}
[eci-worker] 2026-01-02T10:45:57.460Z scheduler tick {"connections":1,"everyMs":60000,"minIntervalMs":300000}
[eci-worker] 2026-01-02T10:45:57.474Z scheduler enqueued TRENDYOL_SYNC_ORDERS {"connectionId":"cmjvat2w40000e6j473j38tno","jobId":"cmjwr0c490003e62g0slslt2n"}
[eci-worker] 2026-01-02T10:45:57.474Z scheduler tick done {"durationMs":35}
[eci-worker] 2026-01-02T10:45:57.475Z job received {"name":"TRENDYOL_SYNC_ORDERS","jobId":"cmjwr0c490003e62g0slslt2n","connectionId":"cmjvat2w40000e6j473j38tno","attempt":1,"maxAttempts":5}
[eci-worker] 2026-01-02T10:45:57.497Z syncOrders started {"connectionId":"cmjvat2w40000e6j473j38tno","status":"Created","startDate":1767349557690,"endDate":1767350637492,"pageSize":50,"windows":1}
[eci-worker] 2026-01-02T10:45:57.497Z syncOrders window started {"connectionId":"cmjvat2w40000e6j473j38tno","window":1,"windows":1,"startDate":1767349557690,"endDate":1767350637492,"status":"Created","pageSize":50}
[eci-worker] 2026-01-02T10:45:57.682Z page processed {"connectionId":"cmjvat2w40000e6j473j38tno","window":1,"windows":1,"page":0,"items":0,"fetched":0,"upserted":0,"totalPages":0,"shipUpserted":0}
[eci-worker] 2026-01-02T10:45:57.682Z syncOrders window finished {"connectionId":"cmjvat2w40000e6j473j38tno","window":1,"windows":1,"startDate":1767349557690,"endDate":1767350637492}
[eci-worker] 2026-01-02T10:45:57.682Z syncOrders finished {"connectionId":"cmjvat2w40000e6j473j38tno","fetched":0,"upserted":0,"shipUpserted":0,"requestedPages":1,"windows":1}
[eci-worker] 2026-01-02T10:45:57.691Z SYNC_SUMMARY {"connectionId":"cmjvat2w40000e6j473j38tno","jobId":"cmjwr0c490003e62g0slslt2n","windowStart":"2026-01-02T10:25:57.690Z","windowEnd":"2026-01-02T10:43:57.492Z","fetched":0,"upserted":0,"inserted":0,"durationMs":192,"usedAutoWindow":true}
[eci-worker] 2026-01-02T10:45:57.699Z job success {"name":"TRENDYOL_SYNC_ORDERS","jobId":"cmjwr0c490003e62g0slslt2n","connectionId":"cmjvat2w40000e6j473j38tno","summary":{"upserted":0,"fetched":0,"inserted":0,"updatedOrExisting":0,"countBefore":2,"countAfter":2,"status":"Created","startDate":1767349557690,"endDate":1767350637492,"pageSize":50,"windows":1,"requestedPages":1,"windowStart":"2026-01-02T10:25:57.690Z","windowEnd":"2026-01-02T10:43:57.492Z","durationMs":192,"usedAutoWindow":true,"overlapMinutes":15,"safetyDelayMinutes":2}}
[eci-worker] 2026-01-02T10:45:57.701Z completed event {"name":"TRENDYOL_SYNC_ORDERS","jobId":"cmjwr0c490003e62g0slslt2n","connectionId":"cmjvat2w40000e6j473j38tno"}
[eci-worker] 2026-01-02T10:46:57.455Z scheduler tick {"connections":1,"everyMs":60000,"minIntervalMs":300000}
[eci-worker] 2026-01-02T10:46:57.457Z scheduler skipped (only_due) {"connectionId":"cmjvat2w40000e6j473j38tno","lastAttemptAgoMs":59973}
[eci-worker] 2026-01-02T10:46:57.457Z scheduler tick done {"durationMs":4}
[eci-worker] 2026-01-02T10:47:57.469Z scheduler tick {"connections":1,"everyMs":60000,"minIntervalMs":300000}
[eci-worker] 2026-01-02T10:47:57.471Z scheduler skipped (only_due) {"connectionId":"cmjvat2w40000e6j473j38tno","lastAttemptAgoMs":119987}
[eci-worker] 2026-01-02T10:47:57.471Z scheduler tick done {"durationMs":5}
[eci-worker] 2026-01-02T10:48:33.287Z job received {"name":"TRENDYOL_SYNC_ORDERS","jobId":"cmjwr3oca0005e6gce7yd32j0","connectionId":"cmjvat2w40000e6j473j38tno","attempt":1,"maxAttempts":5}
[eci-worker] 2026-01-02T10:48:33.308Z syncOrders started {"connectionId":"cmjvat2w40000e6j473j38tno","status":"Created","startDate":1767349857684,"endDate":1767350793304,"pageSize":50,"windows":1}
[eci-worker] 2026-01-02T10:48:33.308Z syncOrders window started {"connectionId":"cmjvat2w40000e6j473j38tno","window":1,"windows":1,"startDate":1767349857684,"endDate":1767350793304,"status":"Created","pageSize":50}
[eci-worker] 2026-01-02T10:48:33.410Z page processed {"connectionId":"cmjvat2w40000e6j473j38tno","window":1,"windows":1,"page":0,"items":0,"fetched":0,"upserted":0,"totalPages":0,"shipUpserted":0}
[eci-worker] 2026-01-02T10:48:33.410Z syncOrders window finished {"connectionId":"cmjvat2w40000e6j473j38tno","window":1,"windows":1,"startDate":1767349857684,"endDate":1767350793304}
[eci-worker] 2026-01-02T10:48:33.410Z syncOrders finished {"connectionId":"cmjvat2w40000e6j473j38tno","fetched":0,"upserted":0,"shipUpserted":0,"requestedPages":1,"windows":1}
[eci-worker] 2026-01-02T10:48:33.418Z SYNC_SUMMARY {"connectionId":"cmjvat2w40000e6j473j38tno","jobId":"cmjwr3oca0005e6gce7yd32j0","windowStart":"2026-01-02T10:30:57.684Z","windowEnd":"2026-01-02T10:46:33.304Z","fetched":0,"upserted":0,"inserted":0,"durationMs":108,"usedAutoWindow":true}
[eci-worker] 2026-01-02T10:48:33.424Z job success {"name":"TRENDYOL_SYNC_ORDERS","jobId":"cmjwr3oca0005e6gce7yd32j0","connectionId":"cmjvat2w40000e6j473j38tno","summary":{"upserted":0,"fetched":0,"inserted":0,"updatedOrExisting":0,"countBefore":2,"countAfter":2,"status":"Created","startDate":1767349857684,"endDate":1767350793304,"pageSize":50,"windows":1,"requestedPages":1,"windowStart":"2026-01-02T10:30:57.684Z","windowEnd":"2026-01-02T10:46:33.304Z","durationMs":108,"usedAutoWindow":true,"overlapMinutes":15,"safetyDelayMinutes":2}}
[eci-worker] 2026-01-02T10:48:33.426Z completed event {"name":"TRENDYOL_SYNC_ORDERS","jobId":"cmjwr3oca0005e6gce7yd32j0","connectionId":"cmjvat2w40000e6j473j38tno"}
~~~

